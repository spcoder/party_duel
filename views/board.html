<template id="boardView">
  <div class="host content">
    <div class="ratio">
      <div class="container">
        <div class="board">
          <div class="panel">
            <div class="blocks">
              <div class="block">
                <div class="cell answer">
                  <div class="text">Go to the beach</div>
                  <label><input type="text"/></label>
                </div>
                <div class="cell score">
                  <div class="text">99</div>
                  <label><input type="text"/></label>
                </div>
              </div>
              <div class="block">
                <div class="cell answer">
                  <div class="text">Swim/Surf</div>
                  <label><input type="text"/></label>
                </div>
                <div class="cell score">
                  <div class="text">17</div>
                  <label><input type="text"/></label>
                </div>
              </div>
              <div class="block">
                <div class="cell answer">
                  <div class="text">Fresh Oranges</div>
                  <label><input type="text"/></label>
                </div>
                <div class="cell score">
                  <div class="text">3</div>
                  <label><input type="text"/></label>
                </div>
              </div>
              <div class="block">
                <div class="cell answer">
                  <div class="text">Go Fishing</div>
                  <label><input type="text"/></label>
                </div>
                <div class="cell score">
                  <div class="text">2</div>
                  <label><input type="text"/></label>
                </div>
              </div>
              <div class="block">
                <div class="cell answer">
                  <div class="text">Sweat</div>
                  <label><input type="text"/></label>
                </div>
                <div class="cell score">
                  <div class="text">2</div>
                  <label><input type="text"/></label>
                </div>
              </div>
              <div class="block">
                <div class="cell answer">
                  <div class="text">Bathing Suits</div>
                  <label><input type="text"/></label>
                </div>
                <div class="cell score">
                  <div class="text">2</div>
                  <label><input type="text"/></label>
                </div>
              </div>
              <div class="block">
                <div class="cell answer">
                  <div class="text">Summer Clothes</div>
                  <label><input type="text"/></label>
                </div>
                <div class="cell score">
                  <div class="text">2</div>
                  <label><input type="text"/></label>
                </div>
              </div>
              <div class="block">
                <div class="cell answer">
                  <div class="text">Go Golfing</div>
                  <label><input type="text"/></label>
                </div>
                <div class="cell score">
                  <div class="text">2</div>
                  <label><input type="text"/></label>
                </div>
              </div>
            </div>
            <div class="footer">
              <div class="cell strikes">
                <div class="text">2 Strikes</div>
              </div>
              <div class="cell joinCode">
                <div class="text">EU57G</div>
              </div>
              <div class="cell edit-switch">
                <div class="text">Edit</div>
              </div>
              <div class="cell total">
                <div class="text">Total 100</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
  app.addView({
    templateId: 'boardView',
    created: function(el) {
      Array.from(el.querySelectorAll('.block')).forEach(block => {
        block.addEventListener('click', e => {
          if (!e.currentTarget.classList.contains('editing')) {
            e.currentTarget.classList.toggle('shown');
          }
        });
      });

      el.querySelector('.edit-switch').addEventListener('click', e => {
        const contentEl = el.querySelector('.content');
        contentEl.classList.toggle('editing');
        if (contentEl.classList.contains('editing')) {
          for (const input of el.querySelectorAll('input')) {
            input.value = input.closest('.cell').querySelector('.text').innerText;
          }
          e.currentTarget.querySelector('.text').innerText = 'Save';
        } else {
          for (const input of el.querySelectorAll('input')) {
            const cell = input.closest('.cell');
            cell.querySelector('.text').innerText = input.value;
          }
          e.currentTarget.querySelector('.text').innerText = 'Edit';
        }

        // const switchText = e.currentTarget.querySelector('.text');
        // if (switchText.innerText.toLowerCase() === 'edit') {
        //   switchText.innerText = 'Save';
        //   for (const block of el.querySelectorAll('.block')) {
        //     for (const input of block.querySelectorAll('input')) {
        //       input.value = input.closest('.cell').querySelector('.text').innerText;
        //     }
        //     block.classList.add('editing');
        //   }
        // } else {
        //   switchText.innerText = 'Edit';
        //   for (const block of el.querySelectorAll('.block')) {
        //     for (const input of block.querySelectorAll('input')) {
        //       const cell = input.closest('.cell');
        //       cell.querySelector('.text').innerText = input.value;
        //     }
        //     block.classList.remove('editing');
        //   }
        // }
      });

      // el.querySelector('#joinCode').innerText = this.state._joinCode;
      // el.querySelector('#teamName1').innerText = this.state.teamName1;
      // el.querySelector('#teamScore1').innerText = this.state.teamScore1;
      // el.querySelector('#teamName2').innerText = this.state.teamName2;
      // el.querySelector('#teamScore2').innerText = this.state.teamScore2;
      // el.querySelector('#question').innerText = this.state.question ?? 'No question';
      // const answers = el.querySelector('#answers');
      // Array(8).fill(null).forEach((_, i) => {
      //   const index = i + 1;
      //   const answer = document.createElement('div');
      //   answer.setAttribute('id', `answer${index}`);
      //   answer.classList.add('answer', !!Reflect.get(this.state, `answer${index}Visible`) ? 'shown' : 'hidden');
      //
      //   const answerTextContainer = document.createElement('div');
      //   answerTextContainer.classList.add('answerTextContainer');
      //
      //   const answerText = document.createElement('div');
      //   answerText.setAttribute('id', `answerText${index}`);
      //   answerText.classList.add('answerText');
      //   answerText.innerText = Reflect.get(this.state, `answer${index}Text`) ?? 'No answer yet';
      //   answerTextContainer.appendChild(answerText);
      //
      //   const answerScoreContainer = document.createElement('div');
      //   answerScoreContainer.classList.add('answerScoreContainer');
      //
      //   const answerScore = document.createElement('div');
      //   answerScore.setAttribute('id', `answerScore${index}`);
      //   answerScore.classList.add('answerScore');
      //   answerScore.innerText = Reflect.get(this.state, `answer${index}Score`) ?? '0';
      //   answerScoreContainer.appendChild(answerScore);
      //
      //   answer.append(answerTextContainer, answerScoreContainer);
      //   answers.append(answer);
      // });

      // el.querySelector('#strikes').innerText = `Strikes: ${this.state.strikes}`;
      //
      // el.querySelectorAll('[id^=answerText]').forEach((n, i) => {
      //   n.innerText = Reflect.get(this.state, `answer${i + 1}Text`) ?? 'Empty answer';
      // });
      // el.querySelectorAll('[id^=answerScore]').forEach((n, i) => {
      //   n.innerText = Reflect.get(this.state, `answer${i + 1}Score`) ?? 'Empty score';
      // });
      // el.querySelectorAll('[id^=answerVisible]').forEach((n, i) => {
      //   n.innerText = (Reflect.get(this.state, `answer${i + 1}Visible`) ?? false) ? 'Hide' : 'Show';
      //   n.addEventListener('click', () => {
      //     this.setNav('visibilityConfirmationIndex', i + 1, '#toggleVisibleConfirmation');
      //   });
      // });
      //
      // el.querySelector('#show-questions-form').addEventListener('click', () => {
      //   this.nav('#questionForm');
      // });
      // el.querySelector('#incrementStrikes').addEventListener('click', () => {
      //   this.setNav('strikesModalDirection', 1, '#strikeConfirmation');
      // });
      // el.querySelector('#decrementStrikes').addEventListener('click', () => {
      //   this.setNav('strikesModalDirection', -1, '#strikeConfirmation');
      // });
    }
  });
</script>

<style>
  .content {
    display: grid;
    padding: 5vh 5vw;
    width: 100vw;
    height: 100vh;
    align-items: center;
    align-content: center;
    background: rgb(20, 20, 20);
    background: radial-gradient(circle, rgba(20, 20, 20, 1) 0%, rgb(38, 38, 38) 100%);
  }

  .ratio {
    aspect-ratio: 16 / 9;
    width: 100%;
    margin: auto;
    max-width: 90vw;
    max-height: 90vh;
  }

  .container {
    display: grid;
    height: 100%;
  }

  .board {
    background: black;
    display: grid;
    padding: 6vmin;
    border-radius: 6vmin;
    box-shadow: inset 0 0 0 2vmin black, inset 0 0 0 4vmin blue;
  }

  .panel {
    display: grid;
    grid-template-rows: 1fr .2fr;
    grid-gap: 2vmin;
    border-radius: 1vmin;
    background: rgb(2, 0, 36);
    background: radial-gradient(circle, rgba(39, 90, 207, 1) 0%, rgba(0, 0, 255, 1) 100%);
    padding: 8vmin 4vmin;
  }

  .footer {
    display: grid;
    grid-template-columns: repeat(2, 33%);
    grid-column-gap: 1vmin;
    justify-content: space-between;
  }

  .host .footer {
    grid-template-columns: repeat(4, 1fr);
  }

  .blocks {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-gap: 2vmin 4vmin;
  }

  .block {
    display: grid;
    grid-template-columns: 1fr 11vmin;
    grid-column-gap: 1vmin;
  }

  .cell {
    display: grid;
    align-items: center;
    padding: 1vmin 2vmin;
    background: black;
    border-radius: 1vmin;
    box-shadow: inset -0.2vmin -0.2vmin 0.4vmin #f9f9f9;
    overflow: hidden;
  }

  .block > .score {
    justify-items: center;
  }

  .cell > .text,
  .cell > label > input {
    line-height: 1;
    margin: 0;
    padding: 0;
    color: var(--v-gray-invert);
    text-transform: uppercase;
    font-size: 3vw;
    animation-duration: 1s;
    white-space: nowrap;
    overflow: hidden;
    animation-fill-mode: forwards;
  }

  .editing .cell:not(.edit-switch) .text {
    display: none;
  }

  .cell > label > input {
    width: 100%;
    color: var(--v-text-base);
    background: transparent;
    border: none;
    outline: none;
    height: 100%;
  }

  .content:not(.editing) label {
    display: none;
  }


  .cell.answer > .text {
    width: 0;
  }

  .cell.score > .text {
    opacity: 0;
    text-align: center;
  }

  .host .cell > .text {
    width: 100%;
    opacity: 0.1;
  }

  .footer > .cell > .text {
    width: 100%;
    opacity: 1;
  }

  .shown .cell.answer > .text {
    animation-name: slideReveal;
  }

  .shown .cell.score > .text {
    animation-name: opacityReveal;
  }

  .host .shown .cell > .text {
    animation-name: opacityReveal;
  }

  .footer > .cell > .text {
    text-align: center;
  }

  .footer > .cell.joinCode,
  .footer > .cell.edit-switch {
    display: none;
  }

  .host .footer > .cell.joinCode,
  .host .footer > .cell.edit-switch {
    display: grid;
  }

  @keyframes slideReveal {
    to {
      width: 100%;
    }
  }

  @keyframes opacityReveal {
    to {
      opacity: 1;
    }
  }
</style>
