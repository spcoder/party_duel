<title>Party Duel</title>
<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.33.1.min.js"></script>
<script>
  console.log('script loaded');

  const uuid = () => {
    const uuid = new Uint32Array(3);
    crypto.getRandomValues(uuid);
    return uuid.join('');
  };

  const USER_ID = 'userId';
  const GAME_CODE = 'gameCode';

  let state = {
    teamName1: undefined,
    teamName2: undefined,
  };

  const setData = (key, value) => {
    localStorage.setItem(key, value);
  };

  const getData = (key, def) => {
    let value = localStorage.getItem(key);
    if (!value) {
      value = def;
      setData(key, value);
    }
    return value;
  };

  window.addEventListener('DOMContentLoaded', () => {
    const pubnub = new PubNub({
      publishKey: "pub-c-c20b0062-2fab-478d-b3a0-df24b3ad656f",
      subscribeKey: "sub-c-e4bd8c4a-3e23-11ec-b2c1-a25c7fcd9558",
      uuid: getData(USER_ID, uuid())
    });
    const channel = 'K3J7L';
    pubnub.subscribe({ channels: [channel] });
    pubnub.addListener({
      status: e => {
        if (e.category === 'PNConnectedCategory') {
          pubnub.publish({
            channel,
            message: 'canhazit?'
          });
        }
      },
      message: e => {
        const { message } = e;
        state = message; // { ...state, ...message };
        console.log('state', state);
      },
      presence: e => {
        console.log('presence', e);
      }
    });
  });
</script>

<h1>Viewer</h1>

<form id="form-join">
  <label>
    Code
    <input type="text" name="sessionId" placeholder="Enter the game code..." autofocus autocomplete="off" autocapitalize="off"/>
  </label>
  <button type="submit">Join</button>
</form>
